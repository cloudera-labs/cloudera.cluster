---

- name: Load defaults
  when: deprecation_msg is defined
  run_once: true
  ansible.builtin.include_role:
    name: cloudera.cluster.cloudera_manager.common

- name: Deprecation warning
  when: deprecation_msg is defined
  run_once: true
  cloudera.cluster.warn:
    msg: "{{ deprecation_msg }}"

- name: Get All services from CM
  cloudera.cluster.cm_api:
    endpoint: "/clusters/{{ cluster_name | urlencode() }}/services"
  register: cloudera_manager_all_services

- name: Handle Restarts
  include_tasks: service_restart.yml
  loop: "{{ services_to_restart }}"
  loop_control:
    loop_var: __service_restart_item
