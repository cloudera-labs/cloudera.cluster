{%- set template_joiner  = joiner(",") -%}
[
{%- for (template_name, template_role_mapping) in definition.hosts.templates.items() -%}
  {{ template_joiner() }}{
    "refName": "HostTemplate-{{ template_name }}",
    "cardinality": 1,
    "roleConfigGroupsRefNames": [
  {%- set role_sep = joiner(",") -%}
  {%- for (service, roles) in template_role_mapping.items() -%}
    {%- if (krb5_kdc_host is defined and service == "HUE"
          and "HUE_SERVER" in roles and not "KT_RENEWER" in roles) -%}
      {{ roles.append("KT_RENEWER") }}
    {%- endif -%}
    {%- for role in roles -%}
      {{ role_sep() }}
      "{{ service }}-1-{{ role }}-BASE"
    {%- endfor -%}
  {%- endfor -%}
    ]
  }
{%- endfor -%}
]
