{
"items" : [
{%- set host_joiner = joiner(",") -%}
{%- for host in groups['cluster'] -%}
  {%- if 'host_template' in hostvars[host]
      and hostvars[host]['host_template'] in cluster.host_templates -%}
    {{ host_joiner() }}
    {
      "hostName" : "{{ cloudera_manager_api_hosts[host]['hostname'] }}",
      "hostTemplateRefName" : "HostTemplate-{{ hostvars[host]['host_template'] }}"
      {%- if 'role_ref_names' in hostvars[host] -%}
      ,"roleRefNames" : [ "{{ hostvars[host]['role_ref_names'] }}" ]
      {%- endif -%}
      {%- if 'rack_id' in hostvars[host] -%}
      ,"rackId" : [ "{{ hostvars[host]['rack_id'] }}" ]
      {%- endif -%}
    }
  {%- endif -%}
{%- endfor -%}
  ]